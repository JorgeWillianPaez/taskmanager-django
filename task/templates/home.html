{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Home - Gerenciador de Tasks</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background-color: #f8f9fa;
      }
      .board {
        display: flex;
        gap: 1rem;
        padding: 2rem;
      }
      .column {
        background: #ffffff;
        border-radius: 0.5rem;
        padding: 1rem;
        flex: 1;
        min-height: 400px;
      }
      .card-task {
        background: #e9ecef;
        padding: 0.75rem 1rem;
        margin-bottom: 0.75rem;
        border-radius: 0.5rem;
      }
    </style>
  </head>
  <body>
    <div class="container py-4">
      <h1 class="mb-4 text-center">Painel de Tasks</h1>
      <div class="d-flex justify-content-end mb-3 gap-2">
        <button
            class="btn btn-primary"
            data-bs-toggle="modal"
            data-bs-target="#createTaskModal"
        >
            Criar Task
        </button>

        <form method="post" action="{% url 'logout' %}">
            {% csrf_token %}
            <button type="submit" class="btn btn-outline-danger">
            Logout
            </button>
        </form>
        </div>

      <div class="board">
        <!-- Coluna Pendente -->
        <div class="column">
          <h5>Pendente</h5>
          {% for task in tasks %}
          {% if task.status == 'PENDENTE' %}
          <div class="card-task">
            <strong>{{ task.name }}</strong>
            <p>{{ task.description }}</p>
            <small>Responsável: {{ task.owner.email }}</small><br>
            {% if task.owner == current_user %}
            <button
                class="btn btn-sm btn-warning mt-2"
                data-bs-toggle="modal"
                data-bs-target="#editTaskModal{{ task.id }}"
            >
                Editar
            </button>
            {% endif %}
          </div>

          <!-- Modal de edição -->
          {% include "edit_task_modal.html" %}
          {% endif %}
          {% endfor %}
        </div>

        <!-- Coluna Em andamento -->
        <div class="column">
          <h5>Em andamento</h5>
          {% for task in tasks %}
          {% if task.status == 'EM_ANDAMENTO' %}
          <div class="card-task">
            <strong>{{ task.name }}</strong>
            <p>{{ task.description }}</p>
            <small>Responsável: {{ task.owner.email }}</small><br>
            {% if task.owner == current_user %}
            <button
                class="btn btn-sm btn-warning mt-2"
                data-bs-toggle="modal"
                data-bs-target="#editTaskModal{{ task.id }}"
            >
                Editar
            </button>
            {% endif %}
          </div>

          <!-- Modal de edição -->
          {% include "edit_task_modal.html" %}
          {% endif %}
          {% endfor %}
        </div>

        <!-- Coluna Concluída -->
        <div class="column">
          <h5>Concluída</h5>
          {% for task in tasks %}
          {% if task.status == 'CONCLUIDA' %}
          <div class="card-task">
            <strong>{{ task.name }}</strong>
            <p>{{ task.description }}</p>
            <small>Responsável: {{ task.owner.email }}</small><br>
            {% if task.owner == current_user %}
            <button
                class="btn btn-sm btn-warning mt-2"
                data-bs-toggle="modal"
                data-bs-target="#editTaskModal{{ task.id }}"
            >
                Editar
            </button>
            {% endif %}
          </div>

          <!-- Modal de edição -->
          {% include "edit_task_modal.html" %}
          {% endif %}
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- Modal de criação de task -->
    <div
      class="modal fade"
      id="createTaskModal"
      tabindex="-1"
      aria-labelledby="createTaskModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <form method="post" action="{% url 'create_task' %}">
            {% csrf_token %}
            <div class="modal-header">
              <h5 class="modal-title" id="createTaskModalLabel">
                Criar Nova Task
              </h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Fechar"
              ></button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <label for="taskName" class="form-label">Nome da Task</label>
                <input
                  type="text"
                  class="form-control"
                  id="taskName"
                  name="name"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="taskDescription" class="form-label">Descrição</label>
                <textarea
                  class="form-control"
                  id="taskDescription"
                  name="description"
                  rows="3"
                ></textarea>
              </div>
              <div class="mb-3">
                <label for="taskOwner" class="form-label">Atribuir a usuário</label>
                <select class="form-select" id="taskOwner" name="owner">
                  <option value="">Não atribuído</option>
                  {% for user in users %}
                  <option value="{{ user.id }}">{{ user.email }}</option>
                  {% endfor %}
                </select>
              </div>
              <div class="mb-3">
                <label for="taskStatus" class="form-label">Status</label>
                <select class="form-select" id="taskStatus" name="status">
                  <option value="PENDENTE">Pendente</option>
                  <option value="EM_ANDAMENTO">Em andamento</option>
                  <option value="CONCLUIDA">Concluída</option>
                </select>
              </div>
            </div>
            <div class="modal-footer">
              <button type="submit" class="btn btn-primary">Criar</button>
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Cancelar
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
